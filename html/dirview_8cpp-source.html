<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HDASS: dirview.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>dirview.cpp</h1><a href="dirview_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** $Id: qt/dirview.cpp   3.3.2   edited Oct 28 15:44 $</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file is part of an example program for Qt.  This example</span>
00007 <span class="comment">** program may be used, distributed and modified without limitation.</span>
00008 <span class="comment">**</span>
00009 <span class="comment">*****************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="dirview_8h.html">dirview.h</a>"</span>
00012 
00013 <span class="preprocessor">#include &lt;qdir.h&gt;</span>
00014 <span class="preprocessor">#include &lt;qfile.h&gt;</span>
00015 <span class="preprocessor">#include &lt;qfileinfo.h&gt;</span>
00016 <span class="preprocessor">#include &lt;qpixmap.h&gt;</span>
00017 <span class="preprocessor">#include &lt;qevent.h&gt;</span>
00018 <span class="preprocessor">#include &lt;qpoint.h&gt;</span>
00019 <span class="preprocessor">#include &lt;qmessagebox.h&gt;</span>
00020 <span class="preprocessor">#include &lt;qdragobject.h&gt;</span>
00021 <span class="preprocessor">#include &lt;qmime.h&gt;</span>
00022 <span class="preprocessor">#include &lt;qstrlist.h&gt;</span>
00023 <span class="preprocessor">#include &lt;qstringlist.h&gt;</span>
00024 <span class="preprocessor">#include &lt;qapplication.h&gt;</span>
00025 <span class="preprocessor">#include &lt;qheader.h&gt;</span>
00026 <span class="preprocessor">#include &lt;kdebug.h&gt;</span>
00027 <span class="preprocessor">#include &lt;qurl.h&gt;</span>
00028 <span class="preprocessor">#include &lt;kio/job.h&gt;</span>
00029 
00030 
00031 
<a name="l00032"></a><a class="code" href="dirview_8cpp.html#a0">00032</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="dirview_8cpp.html#a0">folder_locked</a>[]={
00033     <span class="stringliteral">"16 16 10 1"</span>,
00034     <span class="stringliteral">"h c #808080"</span>,
00035     <span class="stringliteral">"b c #ffa858"</span>,
00036     <span class="stringliteral">"f c #c0c0c0"</span>,
00037     <span class="stringliteral">"e c #c05800"</span>,
00038     <span class="stringliteral">"# c #000000"</span>,
00039     <span class="stringliteral">"c c #ffdca8"</span>,
00040     <span class="stringliteral">". c None"</span>,
00041     <span class="stringliteral">"a c #585858"</span>,
00042     <span class="stringliteral">"g c #a0a0a4"</span>,
00043     <span class="stringliteral">"d c #ffffff"</span>,
00044     <span class="stringliteral">"..#a#..........."</span>,
00045     <span class="stringliteral">".#abc####......."</span>,
00046     <span class="stringliteral">".#daa#eee#......"</span>,
00047     <span class="stringliteral">".#ddf#e##b#....."</span>,
00048     <span class="stringliteral">".#dfd#e#bcb##..."</span>,
00049     <span class="stringliteral">".#fdccc#daaab#.."</span>,
00050     <span class="stringliteral">".#dfbbbccgfg#ba."</span>,
00051     <span class="stringliteral">".#ffb#ebbfgg#ba."</span>,
00052     <span class="stringliteral">".#ffbbe#bggg#ba."</span>,
00053     <span class="stringliteral">".#fffbbebggg#ba."</span>,
00054     <span class="stringliteral">".##hf#ebbggg#ba."</span>,
00055     <span class="stringliteral">"...###e#gggg#ba."</span>,
00056     <span class="stringliteral">".....#e#gggg#ba."</span>,
00057     <span class="stringliteral">"......###ggg#b##"</span>,
00058     <span class="stringliteral">".........##g#b##"</span>,
00059     <span class="stringliteral">"...........####."</span>};
00060 
<a name="l00061"></a><a class="code" href="dirview_8cpp.html#a1">00061</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="dirview_8cpp.html#a1">pix_file</a> []={
00062     <span class="stringliteral">"16 16 7 1"</span>,
00063     <span class="stringliteral">"# c #000000"</span>,
00064     <span class="stringliteral">"b c #ffffff"</span>,
00065     <span class="stringliteral">"e c #000000"</span>,
00066     <span class="stringliteral">"d c #404000"</span>,
00067     <span class="stringliteral">"c c #c0c000"</span>,
00068     <span class="stringliteral">"a c #ffffc0"</span>,
00069     <span class="stringliteral">". c None"</span>,
00070     <span class="stringliteral">"................"</span>,
00071     <span class="stringliteral">".........#......"</span>,
00072     <span class="stringliteral">"......#.#a##...."</span>,
00073     <span class="stringliteral">".....#b#bbba##.."</span>,
00074     <span class="stringliteral">"....#b#bbbabbb#."</span>,
00075     <span class="stringliteral">"...#b#bba##bb#.."</span>,
00076     <span class="stringliteral">"..#b#abb#bb##..."</span>,
00077     <span class="stringliteral">".#a#aab#bbbab##."</span>,
00078     <span class="stringliteral">"#a#aaa#bcbbbbbb#"</span>,
00079     <span class="stringliteral">"#ccdc#bcbbcbbb#."</span>,
00080     <span class="stringliteral">".##c#bcbbcabb#.."</span>,
00081     <span class="stringliteral">"...#acbacbbbe..."</span>,
00082     <span class="stringliteral">"..#aaaacaba#...."</span>,
00083     <span class="stringliteral">"...##aaaaa#....."</span>,
00084     <span class="stringliteral">".....##aa#......"</span>,
00085     <span class="stringliteral">".......##......."</span>};
00086 
<a name="l00087"></a><a class="code" href="dirview_8cpp.html#a2">00087</a> QPixmap *<a class="code" href="dirview_8cpp.html#a2">folderLocked</a> = 0;
<a name="l00088"></a><a class="code" href="dirview_8cpp.html#a3">00088</a> QPixmap *<a class="code" href="dirview_8cpp.html#a3">folderClosed</a> = 0;
<a name="l00089"></a><a class="code" href="dirview_8cpp.html#a4">00089</a> QPixmap *<a class="code" href="dirview_8cpp.html#a4">folderOpen</a> = 0;
<a name="l00090"></a><a class="code" href="dirview_8cpp.html#a5">00090</a> QPixmap *<a class="code" href="dirview_8cpp.html#a5">fileNormal</a> = 0;
00091 
00092 <span class="comment">/*****************************************************************************</span>
00093 <span class="comment"> *</span>
00094 <span class="comment"> * Class Directory</span>
00095 <span class="comment"> *</span>
00096 <span class="comment"> *****************************************************************************/</span>
00097 
<a name="l00098"></a><a class="code" href="classDirectory.html#Directorya2">00098</a> <a class="code" href="classDirectory.html#Directorya0">Directory::Directory</a>( <a class="code" href="classDirectory.html">Directory</a> * parent, <span class="keyword">const</span> QString&amp; filename )
00099     : QListViewItem( parent ), f(filename),
00100       showDirsOnly( parent-&gt;showDirsOnly ),
00101       pix( 0 )
00102 {
00103     
00104     <a class="code" href="classDirectory.html#Directoryr1">p</a> = parent;
00105     <a class="code" href="classDirectory.html#Directoryr2">readable</a> = QDir( <a class="code" href="classDirectory.html#Directorya4">fullName</a>() ).isReadable();
00106 
00107     <span class="keywordflow">if</span> ( !<a class="code" href="classDirectory.html#Directoryr2">readable</a> )
00108         <a class="code" href="classDirectory.html#Directorya8">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a2">folderLocked</a> );
00109     <span class="keywordflow">else</span>
00110         <a class="code" href="classDirectory.html#Directorya8">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a3">folderClosed</a> );
00111 }
00112 
00113 
<a name="l00114"></a><a class="code" href="classDirectory.html#Directorya0">00114</a> <a class="code" href="classDirectory.html#Directorya0">Directory::Directory</a>( QListView * parent, <span class="keyword">const</span> QString&amp; filename )
00115     : QListViewItem( parent ), f(filename),
00116       showDirsOnly( ( (<a class="code" href="classDirectoryView.html">DirectoryView</a>*)parent )-&gt;showDirsOnly() ),
00117       pix( 0 )
00118 {
00119     <a class="code" href="classDirectory.html#Directoryr1">p</a> = 0;<span class="comment">// no parent Directory </span>
00120     <a class="code" href="classDirectory.html#Directoryr2">readable</a> = QDir( <a class="code" href="classDirectory.html#Directorya4">fullName</a>() ).isReadable();
00121 
00122 }
00123 
00124 
<a name="l00125"></a><a class="code" href="classDirectory.html#Directorya8">00125</a> <span class="keywordtype">void</span> <a class="code" href="classDirectory.html#Directorya8">Directory::setPixmap</a>( QPixmap *px )
00126 {
00127     pix = px;
00128     <a class="code" href="classDirectory.html#Directorya6">setup</a>();
00129     widthChanged( 0 );
00130     invalidateHeight();
00131     repaint();
00132 }
00133 
00134 
<a name="l00135"></a><a class="code" href="classDirectory.html#Directorya7">00135</a> <span class="keyword">const</span> QPixmap *<a class="code" href="classDirectory.html#Directorya7">Directory::pixmap</a>( <span class="keywordtype">int</span> i )<span class="keyword"> const</span>
00136 <span class="keyword"></span>{
00137     <span class="keywordflow">if</span> ( i )
00138         <span class="keywordflow">return</span> 0;
00139     <span class="keywordflow">return</span> pix;
00140 }
00141 
<a name="l00142"></a><a class="code" href="classDirectory.html#Directorya5">00142</a> <span class="keywordtype">void</span> <a class="code" href="classDirectory.html#Directorya5">Directory::setOpen</a>( <span class="keywordtype">bool</span> o )
00143 {
00144     <span class="keywordflow">if</span> ( o )
00145         <a class="code" href="classDirectory.html#Directorya8">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a4">folderOpen</a> );
00146     <span class="keywordflow">else</span>
00147         <a class="code" href="classDirectory.html#Directorya8">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a3">folderClosed</a> );
00148 
00149     <span class="keywordflow">if</span> ( o &amp;&amp; !childCount() ) 
00150     {
00151         QString s( <a class="code" href="classDirectory.html#Directorya4">fullName</a>() );
00152         QDir thisDir( s );
00153         <span class="keywordflow">if</span> ( !thisDir.isReadable() ) 
00154         {
00155             <a class="code" href="classDirectory.html#Directoryr2">readable</a> = FALSE;
00156             setExpandable( FALSE );
00157             <span class="keywordflow">return</span>;
00158         }
00159 
00160         listView()-&gt;setUpdatesEnabled( FALSE );
00161         <span class="keyword">const</span> QFileInfoList * files = thisDir.entryInfoList();
00162         <span class="keywordflow">if</span> ( files ) {
00163             QFileInfoListIterator it( *files );
00164             QFileInfo * fi;
00165             <span class="keywordflow">while</span>( (fi=it.current()) != 0 ) {
00166                 ++it;
00167                 <span class="keywordflow">if</span> ( fi-&gt;fileName() == <span class="stringliteral">"."</span> || fi-&gt;fileName() == <span class="stringliteral">".."</span> )
00168                     ; <span class="comment">// nothing</span>
00169                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fi-&gt;isSymLink() &amp;&amp; !<a class="code" href="classDirectory.html#Directoryr3">showDirsOnly</a> ) {
00170                     <a class="code" href="classFileItem.html">FileItem</a> *item = <span class="keyword">new</span> <a class="code" href="classFileItem.html">FileItem</a>( <span class="keyword">this</span>, fi-&gt;fileName(),
00171                                                      <span class="stringliteral">"Symbolic Link"</span> );
00172                     item-&gt;<a class="code" href="classFileItem.html#FileItema2">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a5">fileNormal</a> );
00173                 }
00174                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( fi-&gt;isDir() )
00175                 {
00176                     (<span class="keywordtype">void</span>)<span class="keyword">new</span> <a class="code" href="classDirectory.html#Directorya0">Directory</a>( <span class="keyword">this</span>, fi-&gt;fileName() );
00177                 }
00178                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !<a class="code" href="classDirectory.html#Directoryr3">showDirsOnly</a> ) {
00179                     <a class="code" href="classFileItem.html">FileItem</a> *item
00180                         = <span class="keyword">new</span> <a class="code" href="classFileItem.html">FileItem</a>( <span class="keyword">this</span>, fi-&gt;fileName(),
00181                                              fi-&gt;isFile()?<span class="stringliteral">"File"</span>:<span class="stringliteral">"Special"</span> );
00182                     item-&gt;<a class="code" href="classFileItem.html#FileItema2">setPixmap</a>( <a class="code" href="dirview_8cpp.html#a5">fileNormal</a> );
00183                 }
00184             }
00185         }
00186         listView()-&gt;setUpdatesEnabled( TRUE );
00187     }
00188     QListViewItem::setOpen( o );
00189 }
00190 
00191 
<a name="l00192"></a><a class="code" href="classDirectory.html#Directorya6">00192</a> <span class="keywordtype">void</span> <a class="code" href="classDirectory.html#Directorya6">Directory::setup</a>()
00193 {
00194     setExpandable( TRUE );
00195     QListViewItem::setup();
00196 }
00197 
00198 
<a name="l00199"></a><a class="code" href="classDirectory.html#Directorya4">00199</a> QString <a class="code" href="classDirectory.html#Directorya4">Directory::fullName</a>()
00200 {
00201     QString s;
00202     <span class="keywordflow">if</span> ( <a class="code" href="classDirectory.html#Directoryr1">p</a> ) {
00203         s = <a class="code" href="classDirectory.html#Directoryr1">p</a>-&gt;<a class="code" href="classDirectory.html#Directorya4">fullName</a>();
00204         s.append( <a class="code" href="classDirectory.html#Directoryr0">f</a>.name() );
00205         s.append( <span class="stringliteral">"/"</span> );
00206     } <span class="keywordflow">else</span> {
00207         s = <a class="code" href="classDirectory.html#Directoryr0">f</a>.name();
00208     }
00209     <span class="keywordflow">return</span> s;
00210 }
00211 
00212 
<a name="l00213"></a><a class="code" href="classDirectory.html#Directorya3">00213</a> QString <a class="code" href="classDirectory.html#Directorya3">Directory::text</a>( <span class="keywordtype">int</span> column )<span class="keyword"> const</span>
00214 <span class="keyword"></span>{
00215     <span class="keywordflow">if</span> ( column == 0 )
00216         <span class="keywordflow">return</span> <a class="code" href="classDirectory.html#Directoryr0">f</a>.name();
00217     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classDirectory.html#Directoryr2">readable</a> )
00218         <span class="keywordflow">return</span> <span class="stringliteral">"Directory"</span>;
00219     <span class="keywordflow">else</span>
00220         <span class="keywordflow">return</span> <span class="stringliteral">"Unreadable Directory"</span>;
00221 }
<a name="l00222"></a><a class="code" href="classDirectory.html#Directorya9">00222</a> <span class="keywordtype">void</span> <a class="code" href="classDirectory.html#Directorya9">Directory::Mkdir</a>(QString s)
00223 {
00224         QDir currDir=QDir( <a class="code" href="classDirectory.html#Directorya4">fullName</a>() );
00225         qWarning(<a class="code" href="classDirectory.html#Directorya4">fullName</a>());
00226         <span class="comment">//DAVID need modified</span>
00227         currDir.mkdir(s);
00228         <span class="keyword">new</span> <a class="code" href="classDirectory.html#Directorya0">Directory</a>(<span class="keyword">this</span>,s);
00229 }
00230 <span class="comment">/*****************************************************************************</span>
00231 <span class="comment"> *</span>
00232 <span class="comment"> * Class DirectoryView</span>
00233 <span class="comment"> *</span>
00234 <span class="comment"> *****************************************************************************/</span>
00235 
<a name="l00236"></a><a class="code" href="classDirectoryView.html#DirectoryViewa0">00236</a> <a class="code" href="classDirectoryView.html#DirectoryViewa0">DirectoryView::DirectoryView</a>( <a class="code" href="classQWidget.html">QWidget</a> *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">bool</span> sdo )
00237     : QListView( parent, name ), dirsOnly( sdo ), oldCurrent( 0 ),
00238       dropItem( 0 ), mousePressed( FALSE )
00239 {
00240     <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a> = <span class="keyword">new</span> QTimer( <span class="keyword">this</span> );
00241     <span class="keywordflow">if</span> ( !<a class="code" href="dirview_8cpp.html#a2">folderLocked</a> ) {
00242         <a class="code" href="dirview_8cpp.html#a2">folderLocked</a> = <span class="keyword">new</span> QPixmap( <a class="code" href="dirview_8cpp.html#a0">folder_locked</a> );
00243         <a class="code" href="dirview_8cpp.html#a3">folderClosed</a> = <span class="keyword">new</span> QPixmap( <span class="stringliteral">"/root/kde_application/hdass08/skin/folder_sound.png"</span> );
00244         <a class="code" href="dirview_8cpp.html#a4">folderOpen</a> = <span class="keyword">new</span> QPixmap( <span class="stringliteral">"/root/kde_application/hdass08/skin/folder_sound.png"</span> );
00245         <a class="code" href="dirview_8cpp.html#a5">fileNormal</a> = <span class="keyword">new</span> QPixmap( <a class="code" href="dirview_8cpp.html#a1">pix_file</a> );
00246     }
00247 
00248     connect( <span class="keyword">this</span>, SIGNAL( doubleClicked( QListViewItem * ) ),
00249              <span class="keyword">this</span>, SLOT( <a class="code" href="classDirectoryView.html#DirectoryViewj0">slotFolderSelected</a>( QListViewItem * ) ) );
00250     connect( <span class="keyword">this</span>, SIGNAL( returnPressed( QListViewItem * ) ),
00251              <span class="keyword">this</span>, SLOT( <a class="code" href="classDirectoryView.html#DirectoryViewj0">slotFolderSelected</a>( QListViewItem * ) ) );
00252 
00253     setAcceptDrops( TRUE );
00254     viewport()-&gt;setAcceptDrops( TRUE );
00255 
00256     connect( <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>, SIGNAL( timeout() ),
00257              <span class="keyword">this</span>, SLOT( <a class="code" href="classDirectoryView.html#DirectoryViewj1">openFolder</a>() ) );
00258 }
00259 
<a name="l00260"></a><a class="code" href="classDirectoryView.html#DirectoryViewj0">00260</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewj0">DirectoryView::slotFolderSelected</a>( QListViewItem *i )
00261 {
00262     <span class="keywordflow">if</span> ( !i || !<a class="code" href="classDirectoryView.html#DirectoryViewa1">showDirsOnly</a>() )
00263         <span class="keywordflow">return</span>;
00264 
00265     <a class="code" href="classDirectory.html">Directory</a> *dir = (<a class="code" href="classDirectory.html">Directory</a>*)i;
00266     emit <a class="code" href="classDirectoryView.html#DirectoryViewl0">folderSelected</a>( dir-&gt;<a class="code" href="classDirectory.html#Directorya4">fullName</a>() );
00267 }
00268 
<a name="l00269"></a><a class="code" href="classDirectoryView.html#DirectoryViewj1">00269</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewj1">DirectoryView::openFolder</a>()
00270 {
00271     <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;stop();
00272     <span class="keywordflow">if</span> ( <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> &amp;&amp; !<a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a>-&gt;isOpen() ) {
00273         <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a>-&gt;setOpen( TRUE );
00274         <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a>-&gt;repaint();
00275     }
00276 }
00277 
<a name="l00278"></a><a class="code" href="dirview_8cpp.html#a6">00278</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="dirview_8cpp.html#a6">autoopenTime</a> = 750;
00279 
00280 
<a name="l00281"></a><a class="code" href="classDirectoryView.html#DirectoryViewb0">00281</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb0">DirectoryView::contentsDragEnterEvent</a>( QDragEnterEvent *e )
00282 {
00283     <span class="keywordflow">if</span> ( !QUriDrag::canDecode(e) ) {
00284         e-&gt;ignore();
00285         <span class="keywordflow">return</span>;
00286     }
00287 
00288     <a class="code" href="classDirectoryView.html#DirectoryViewr1">oldCurrent</a> = currentItem();
00289 
00290     QListViewItem *i = itemAt( contentsToViewport(e-&gt;pos()) );
00291     <span class="keywordflow">if</span> ( i ) {
00292         <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> = i;
00293         <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;start( <a class="code" href="dirview_8cpp.html#a6">autoopenTime</a> );
00294     }
00295     
00296 }
00297 
00298 
<a name="l00299"></a><a class="code" href="classDirectoryView.html#DirectoryViewb1">00299</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb1">DirectoryView::contentsDragMoveEvent</a>( QDragMoveEvent *e )
00300 {
00301     <span class="keywordflow">if</span> ( !QUriDrag::canDecode(e) ) {
00302         e-&gt;ignore();
00303         <span class="keywordflow">return</span>;
00304     }
00305 
00306     QPoint vp = contentsToViewport( ( (QDragMoveEvent*)e )-&gt;pos() );
00307     QListViewItem *i = itemAt( vp );
00308     
00309     <span class="keywordflow">if</span> ( i ) {
00310         setSelected( i, TRUE );
00311         e-&gt;accept();
00312         <span class="keywordflow">if</span> ( i != <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> ) {
00313             <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;stop();
00314             <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> = i;
00315             <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;start( <a class="code" href="dirview_8cpp.html#a6">autoopenTime</a> );
00316         }
00317         <span class="keywordflow">switch</span> ( e-&gt;action() ) {
00318         <span class="keywordflow">case</span> QDropEvent::Copy:
00319             <span class="keywordflow">break</span>;
00320         <span class="keywordflow">case</span> QDropEvent::Move:
00321             e-&gt;acceptAction();
00322             <span class="keywordflow">break</span>;
00323         <span class="keywordflow">case</span> QDropEvent::Link:
00324             e-&gt;acceptAction();
00325             <span class="keywordflow">break</span>;
00326         <span class="keywordflow">default</span>:
00327             ;
00328         }
00329     } <span class="keywordflow">else</span> {
00330         e-&gt;ignore();
00331         <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;stop();
00332         <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> = 0;
00333     }
00334 }
00335 
<a name="l00336"></a><a class="code" href="classDirectoryView.html#DirectoryViewb2">00336</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb2">DirectoryView::contentsDragLeaveEvent</a>( QDragLeaveEvent * )
00337 {
00338     <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;stop();
00339     <a class="code" href="classDirectoryView.html#DirectoryViewr2">dropItem</a> = 0;
00340 
00341     setCurrentItem( <a class="code" href="classDirectoryView.html#DirectoryViewr1">oldCurrent</a> );
00342     setSelected( <a class="code" href="classDirectoryView.html#DirectoryViewr1">oldCurrent</a>, TRUE );
00343 }
00344 
<a name="l00345"></a><a class="code" href="classDirectoryView.html#DirectoryViewb3">00345</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb3">DirectoryView::contentsDropEvent</a>( QDropEvent *e )
00346 {
00347     <a class="code" href="classDirectoryView.html#DirectoryViewr3">autoopen_timer</a>-&gt;stop();
00348 
00349     <span class="keywordflow">if</span> ( !QUriDrag::canDecode(e) ) {
00350         e-&gt;ignore();
00351         <span class="keywordflow">return</span>;
00352     }
00353 
00354     QListViewItem *item = itemAt( contentsToViewport(e-&gt;pos()) );
00355     
00356     <span class="keywordflow">if</span>(item)
00357     {
00358         <span class="comment">//DAVID make a list to receive the dropping objects</span>
00359         QStrList lst;
00360         
00361         <span class="comment">//DAVID decode the objects data to list</span>
00362         QUriDrag::decode( e, lst );
00363         
00364         QString DirName=QDir::convertSeparators(<a class="code" href="classDirectoryView.html#DirectoryViewd0">fullPath</a>(item));
00365 
00366         <span class="keywordflow">for</span> ( uint i = 0; i &lt; lst.count(); ++i ) 
00367         
00368         {
00369                 
00370                 <span class="comment">//kdDebug()&lt;&lt;lst.at(i);</span>
00371                 <span class="comment">//DAVID get the dropping object name</span>
00372                 QString fullpathfilename = QDir::convertSeparators(QUriDrag::uriToLocalFile(lst.at(i)));
00373                 QUrl url(fullpathfilename);
00374                 QString filename=url.fileName();
00375                 QString distfilename=DirName+QString(<span class="stringliteral">"/"</span>)+filename;
00376                 <span class="comment">//copy file</span>
00377                 KIO::copy(KURL(fullpathfilename),KURL(distfilename),<span class="keyword">false</span>);
00378         }
00379         
00380     }
00381     <span class="keywordflow">else</span>
00382     {
00383      e-&gt;ignore();
00384     }
00385 
00386 }
00387 
00388 
<a name="l00389"></a><a class="code" href="classDirectoryView.html#DirectoryViewd0">00389</a> QString <a class="code" href="classDirectoryView.html#DirectoryViewd0">DirectoryView::fullPath</a>(QListViewItem* item)
00390 {
00391     QString fullpath = item-&gt;text(0);
00392     <span class="keywordflow">while</span> ( (item=item-&gt;parent()) ) {
00393         <span class="keywordflow">if</span> ( item-&gt;parent() )
00394             fullpath = item-&gt;text(0) + <span class="stringliteral">"/"</span> + fullpath;
00395         <span class="keywordflow">else</span>
00396             fullpath = item-&gt;text(0) + fullpath;
00397     }
00398 <span class="preprocessor">#ifdef Q_WS_WIN</span>
00399 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (fullpath.length() &gt; 2 &amp;&amp; fullpath[1] != <span class="charliteral">':'</span>) {
00400                 QDir dir(fullpath);
00401                 fullpath = dir.currentDirPath().left(2) + fullpath;
00402         }
00403 <span class="preprocessor">#endif</span>
00404 <span class="preprocessor"></span>        
00405     <span class="keywordflow">return</span> fullpath;
00406 }
00407 
<a name="l00408"></a><a class="code" href="classDirectoryView.html#DirectoryViewb5">00408</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb5">DirectoryView::contentsMousePressEvent</a>( QMouseEvent* e )
00409 {
00410     QListView::contentsMousePressEvent(e);
00411     QPoint p( contentsToViewport( e-&gt;pos() ) );
00412     QListViewItem *i = itemAt( p );
00413     <span class="keywordflow">if</span> ( i ) {
00414         <span class="comment">// if the user clicked into the root decoration of the item, don't try to start a drag!</span>
00415         <span class="keywordflow">if</span> ( p.x() &gt; header()-&gt;cellPos( header()-&gt;mapToActual( 0 ) ) +
00416              treeStepSize() * ( i-&gt;depth() + ( rootIsDecorated() ? 1 : 0) ) + itemMargin() ||
00417              p.x() &lt; header()-&gt;cellPos( header()-&gt;mapToActual( 0 ) ) ) {
00418             <a class="code" href="classDirectoryView.html#DirectoryViewr4">presspos</a> = e-&gt;pos();
00419             <a class="code" href="classDirectoryView.html#DirectoryViewr5">mousePressed</a> = TRUE;
00420         }
00421     }
00422 }
00423 
<a name="l00424"></a><a class="code" href="classDirectoryView.html#DirectoryViewb4">00424</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb4">DirectoryView::contentsMouseMoveEvent</a>( QMouseEvent* e )
00425 {
00426     <span class="keywordflow">if</span> ( <a class="code" href="classDirectoryView.html#DirectoryViewr5">mousePressed</a> &amp;&amp; ( <a class="code" href="classDirectoryView.html#DirectoryViewr4">presspos</a> - e-&gt;pos() ).manhattanLength() &gt; QApplication::startDragDistance() ) {
00427         <a class="code" href="classDirectoryView.html#DirectoryViewr5">mousePressed</a> = FALSE;
00428         QListViewItem *item = itemAt( contentsToViewport(<a class="code" href="classDirectoryView.html#DirectoryViewr4">presspos</a>) );
00429         <span class="keywordflow">if</span> ( item ) {
00430             QString source = <a class="code" href="classDirectoryView.html#DirectoryViewd0">fullPath</a>(item);
00431             <span class="keywordflow">if</span> ( QFile::exists(source) ) {
00432                 QUriDrag* ud = <span class="keyword">new</span> QUriDrag(viewport());
00433                 ud-&gt;setFileNames( source );
00434                 <span class="keywordflow">if</span> ( ud-&gt;drag() )
00435                     QMessageBox::information( <span class="keyword">this</span>, <span class="stringliteral">"Drag source"</span>,
00436                     QString(<span class="stringliteral">"Delete "</span>) + QDir::convertSeparators(source), <span class="stringliteral">"Not implemented"</span> );
00437             }
00438         }
00439     }
00440 }
00441 
<a name="l00442"></a><a class="code" href="classDirectoryView.html#DirectoryViewb6">00442</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewb6">DirectoryView::contentsMouseReleaseEvent</a>( QMouseEvent * )
00443 {
00444     <a class="code" href="classDirectoryView.html#DirectoryViewr5">mousePressed</a> = FALSE;
00445 }
00446 
<a name="l00447"></a><a class="code" href="classDirectoryView.html#DirectoryViewi0">00447</a> <span class="keywordtype">void</span> <a class="code" href="classDirectoryView.html#DirectoryViewi0">DirectoryView::setDir</a>( <span class="keyword">const</span> QString &amp;s )
00448 {
00449     QListViewItemIterator it( <span class="keyword">this</span> );
00450     ++it;
00451     <span class="keywordflow">for</span> ( ; it.current(); ++it ) {
00452         it.current()-&gt;setOpen( FALSE );
00453     }
00454 
00455     QStringList lst( QStringList::split( <span class="stringliteral">"/"</span>, s ) );
00456     QListViewItem *item = firstChild();
00457     QStringList::Iterator it2 = lst.begin();
00458     <span class="keywordflow">for</span> ( ; it2 != lst.end(); ++it2 ) {
00459         <span class="keywordflow">while</span> ( item ) {
00460             <span class="keywordflow">if</span> ( item-&gt;text( 0 ) == *it2 ) {
00461                 item-&gt;setOpen( TRUE );
00462                 <span class="keywordflow">break</span>;
00463             }
00464             item = item-&gt;itemBelow();
00465         }
00466     }
00467 
00468     <span class="keywordflow">if</span> ( item )
00469         setCurrentItem( item );
00470 }
00471 
<a name="l00472"></a><a class="code" href="classFileItem.html#FileItema2">00472</a> <span class="keywordtype">void</span> <a class="code" href="classFileItem.html#FileItema2">FileItem::setPixmap</a>( QPixmap *p )
00473 {
00474     <a class="code" href="classFileItem.html#FileItemr0">pix</a> = p;
00475     setup();
00476     widthChanged( 0 );
00477     invalidateHeight();
00478     repaint();
00479 }
00480 
00481 
<a name="l00482"></a><a class="code" href="classFileItem.html#FileItema1">00482</a> <span class="keyword">const</span> QPixmap *<a class="code" href="classFileItem.html#FileItema1">FileItem::pixmap</a>( <span class="keywordtype">int</span> i )<span class="keyword"> const</span>
00483 <span class="keyword"></span>{
00484     <span class="keywordflow">if</span> ( i )
00485         <span class="keywordflow">return</span> 0;
00486     <span class="keywordflow">return</span> <a class="code" href="classFileItem.html#FileItemr0">pix</a>;
00487 }
00488 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 13 16:53:34 2005 for HDASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
