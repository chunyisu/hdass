<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HDASS: hdassclock.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>hdassclock.cpp</h1><a href="hdassclock_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/***************************************************************************</span>
00002 <span class="comment"> *   Copyright (C) 2004 by root                                            *</span>
00003 <span class="comment"> *   root@colicoli                                                         *</span>
00004 <span class="comment"> *                                                                         *</span>
00005 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
00006 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
00007 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
00008 <span class="comment"> *   (at your option) any later version.                                   *</span>
00009 <span class="comment"> *                                                                         *</span>
00010 <span class="comment"> *   This program is distributed in the hope that it will be useful,       *</span>
00011 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *</span>
00012 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *</span>
00013 <span class="comment"> *   GNU General Public License for more details.                          *</span>
00014 <span class="comment"> *                                                                         *</span>
00015 <span class="comment"> *   You should have received a copy of the GNU General Public License     *</span>
00016 <span class="comment"> *   along with this program; if not, write to the                         *</span>
00017 <span class="comment"> *   Free Software Foundation, Inc.,                                       *</span>
00018 <span class="comment"> *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *</span>
00019 <span class="comment"> ***************************************************************************/</span>
00020 <span class="preprocessor">#include "<a class="code" href="hdassclock_8h.html">hdassclock.h</a>"</span>
00021 <span class="preprocessor">#include &lt;qpainter.h&gt;</span>
00022 <span class="preprocessor">#include &lt;qbitmap.h&gt;</span>
00023 <span class="preprocessor">#include &lt;kdebug.h&gt;</span>
<a name="l00024"></a><a class="code" href="classhdassClock.html#hdassClocka0">00024</a> <a class="code" href="classhdassClock.html#hdassClocka0">hdassClock::hdassClock</a>(<a class="code" href="classQWidget.html">QWidget</a> *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00025  : <a class="code" href="classQWidget.html">QWidget</a>(parent, name)
00026 {
00027    <a class="code" href="classhdassClock.html#hdassClocka1">xSetup</a>();
00028 }
00029 
00030 
<a name="l00031"></a><a class="code" href="classhdassClock.html#hdassClocka2">00031</a> <a class="code" href="classhdassClock.html#hdassClocka2">hdassClock::~hdassClock</a>()
00032 {
00033 
00034 }
00035 
<a name="l00036"></a><a class="code" href="classhdassClock.html#hdassClocka1">00036</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClocka1">hdassClock::xSetup</a>()
00037 {
00038     <a class="code" href="classhdassClock.html#hdassClockr1">time</a> = QTime::currentTime();                <span class="comment">// get current time</span>
00039     <a class="code" href="classhdassClock.html#hdassClockr2">internalTimer</a> = <span class="keyword">new</span> QTimer( <span class="keyword">this</span> ); <span class="comment">// create internal timer</span>
00040     connect( <a class="code" href="classhdassClock.html#hdassClockr2">internalTimer</a>, SIGNAL(<a class="code" href="classhdassClock.html#hdassClockk0">timeout</a>()), SLOT(<a class="code" href="classhdassClock.html#hdassClockk0">timeout</a>()) );
00041     <a class="code" href="classhdassClock.html#hdassClockr2">internalTimer</a>-&gt;start( 5000 );               <span class="comment">// emit signal every 5 seconds</span>
00042     
00043     <span class="comment">//DAVID Setbackgorund</span>
00044     pixBackground.load(<span class="stringliteral">"/root/kde_application/hdass08/skin/ClockBackground.png"</span>);
00045     setBackgroundPixmap(pixBackground);
00046     
00047 }
00048 
<a name="l00049"></a><a class="code" href="classhdassClock.html#hdassClocki0">00049</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClocki0">hdassClock::setTime</a>(<span class="keyword">const</span> QTime &amp; t)
00050 {
00051   <a class="code" href="classhdassClock.html#hdassClockr1">time</a> = t;
00052     disconnect( <a class="code" href="classhdassClock.html#hdassClockr2">internalTimer</a>, SIGNAL(<a class="code" href="classhdassClock.html#hdassClockk0">timeout</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="classhdassClock.html#hdassClockk0">timeout</a>()) );
00053     <span class="keywordflow">if</span> (autoMask())
00054         <a class="code" href="classhdassClock.html#hdassClockb0">updateMask</a>();
00055     <span class="keywordflow">else</span>
00056         update();
00057  
00058 }
00059 
<a name="l00060"></a><a class="code" href="classhdassClock.html#hdassClockk0">00060</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClockk0">hdassClock::timeout</a>()
00061 {
00062     QTime old_time = <a class="code" href="classhdassClock.html#hdassClockr1">time</a>;
00063     time = QTime::currentTime();
00064     <span class="keywordflow">if</span> ( old_time.minute() != time.minute() 
00065         || old_time.hour() != time.hour() ) {   <span class="comment">// minute or hour has changed</span>
00066         <span class="keywordflow">if</span> (autoMask())
00067             <a class="code" href="classhdassClock.html#hdassClockb0">updateMask</a>();
00068         <span class="keywordflow">else</span>
00069             update();
00070     }
00071 }
00072 
<a name="l00073"></a><a class="code" href="classhdassClock.html#hdassClockb1">00073</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClockb1">hdassClock::paintEvent</a>(QPaintEvent *)
00074 {
00075     <span class="keywordflow">if</span> ( autoMask() )
00076         <span class="keywordflow">return</span>;
00077     QPainter paint( <span class="keyword">this</span> );
00078     paint.setBrush( colorGroup().foreground() );
00079     <a class="code" href="classhdassClock.html#hdassClockb2">drawClock</a>( &amp;paint );
00080 }
00081 
<a name="l00082"></a><a class="code" href="classhdassClock.html#hdassClockb0">00082</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClockb0">hdassClock::updateMask</a>()
00083 {
00084    QBitmap bm( size() );
00085     <span class="comment">//bm.fill( color0 );                        //transparent</span>
00086 
00087     QPainter paint;
00088     paint.begin( &amp;bm, <span class="keyword">this</span> );
00089     QBrush brush=QBrush(white);
00090     brush.setStyle(SolidPattern); 
00091     paint.setBrush( brush );            <span class="comment">// use non-transparent color</span>
00092     paint.setPen(color1);
00093 
00094     <a class="code" href="classhdassClock.html#hdassClockb2">drawClock</a>( &amp;paint );
00095 
00096     paint.end();
00097     setMask( bm );
00098 }
00099 
<a name="l00100"></a><a class="code" href="classhdassClock.html#hdassClockb2">00100</a> <span class="keywordtype">void</span> <a class="code" href="classhdassClock.html#hdassClockb2">hdassClock::drawClock</a>( QPainter *paint )
00101 {
00102     paint-&gt;setPen(Qt::white);
00103     paint-&gt;save();
00104     
00105     paint-&gt;setWindow( -500,-500, 1000,1000 );
00106 
00107     QRect v = paint-&gt;viewport();
00108     <span class="keywordtype">int</span> d = QMIN( v.width(), v.height() );
00109     paint-&gt;setViewport( v.left() + (v.width()-d)/2,v.top() + (v.height()-d)/2, d, d );
00110     QPointArray pts;
00111 
00112     paint-&gt;save();
00113     
00114     paint-&gt;rotate( 30*(<a class="code" href="classhdassClock.html#hdassClockr1">time</a>.hour()%12-3) + <a class="code" href="classhdassClock.html#hdassClockr1">time</a>.minute()/2 ); 
00115     QPixmap hr;
00116     hr.load(<span class="stringliteral">"/root/kde_application/hdass08/skin/hdassClockArrowHr.png"</span>); 
00117     paint-&gt;drawPixmap(0,(hr.height()/2)-100,hr);
00118     paint-&gt;restore();
00119 
00120     paint-&gt;save();
00121     paint-&gt;rotate( (<a class="code" href="classhdassClock.html#hdassClockr1">time</a>.minute()-15)*6 );
00122     QPixmap min;
00123     min.load(<span class="stringliteral">"/root/kde_application/hdass08/skin/hdassClockArrowMin.png"</span>);
00124     paint-&gt;drawPixmap(0,(min.height()/2)-90,min);
00125     paint-&gt;restore();
00126 }
00127 
00128 <span class="preprocessor">#include "<a class="code" href="hdassclock_8moc.html">hdassclock.moc</a>"</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 13 16:53:35 2005 for HDASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
