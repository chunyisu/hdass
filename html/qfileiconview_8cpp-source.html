<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>HDASS: qfileiconview.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>qfileiconview.cpp</h1><a href="qfileiconview_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">** $Id: qt/qfileiconview.cpp   3.3.2   edited Nov 18 10:39 $</span>
00003 <span class="comment">**</span>
00004 <span class="comment">** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.</span>
00005 <span class="comment">**</span>
00006 <span class="comment">** This file is part of an example program for Qt.  This example</span>
00007 <span class="comment">** program may be used, distributed and modified without limitation.</span>
00008 <span class="comment">**</span>
00009 <span class="comment">*****************************************************************************/</span>
00010 
00011 <span class="preprocessor">#include "<a class="code" href="qfileiconview_8h.html">qfileiconview.h</a>"</span>
00012 <span class="preprocessor">#include &lt;qpainter.h&gt;</span>
00013 <span class="preprocessor">#include &lt;qstringlist.h&gt;</span>
00014 <span class="preprocessor">#include &lt;qpixmap.h&gt;</span>
00015 <span class="preprocessor">#include &lt;qmime.h&gt;</span>
00016 <span class="preprocessor">#include &lt;qstrlist.h&gt;</span>
00017 <span class="preprocessor">#include &lt;qdragobject.h&gt;</span>
00018 <span class="preprocessor">#include &lt;qmessagebox.h&gt;</span>
00019 <span class="preprocessor">#include &lt;qevent.h&gt;</span>
00020 <span class="preprocessor">#include &lt;qpopupmenu.h&gt;</span>
00021 <span class="preprocessor">#include &lt;qcursor.h&gt;</span>
00022 <span class="preprocessor">#include &lt;qapplication.h&gt;</span>
00023 <span class="preprocessor">#include &lt;qwmatrix.h&gt;</span>
00024 <span class="preprocessor">#include &lt;math.h&gt;</span>
00025 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00026 <span class="preprocessor">#include &lt;kdebug.h&gt;</span>
00027 
<a name="l00028"></a><a class="code" href="qfileiconview_8cpp.html#a0">00028</a> <span class="keyword">static</span> QPixmap *<a class="code" href="qfileiconview_8cpp.html#a0">iconFileLarge</a> = 0;
<a name="l00029"></a><a class="code" href="qfileiconview_8cpp.html#a1">00029</a> QPixmap *<a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[100];
<a name="l00030"></a><a class="code" href="qfileiconview_8cpp.html#a2">00030</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="qfileiconview_8cpp.html#a2">cleanup</a>()
00031 {
00032     
00033     <span class="keyword">delete</span> <a class="code" href="qfileiconview_8cpp.html#a0">iconFileLarge</a>;
00034     <a class="code" href="qfileiconview_8cpp.html#a0">iconFileLarge</a> = 0;
00035     
00036 }
00037 
00038 <span class="comment">/*****************************************************************************</span>
00039 <span class="comment"> *</span>
00040 <span class="comment"> * Class QtFileIconDrag</span>
00041 <span class="comment"> *</span>
00042 <span class="comment"> *****************************************************************************/</span>
00043 
<a name="l00044"></a><a class="code" href="classQtFileIconDrag.html#QtFileIconDraga0">00044</a> <a class="code" href="classQtFileIconDrag.html#QtFileIconDraga0">QtFileIconDrag::QtFileIconDrag</a>( <a class="code" href="classQWidget.html">QWidget</a> * dragSource, <span class="keyword">const</span> <span class="keywordtype">char</span>* name )
00045     : QIconDrag( dragSource, name )
00046 {
00047 }
00048 
<a name="l00049"></a><a class="code" href="classQtFileIconDrag.html#QtFileIconDraga1">00049</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classQtFileIconDrag.html#QtFileIconDraga1">QtFileIconDrag::format</a>( <span class="keywordtype">int</span> i )<span class="keyword"> const</span>
00050 <span class="keyword"></span>{
00051     <span class="keywordflow">if</span> ( i == 0 )
00052         <span class="keywordflow">return</span> <span class="stringliteral">"application/x-qiconlist"</span>;
00053     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i == 1 )
00054         <span class="keywordflow">return</span> <span class="stringliteral">"text/uri-list"</span>;
00055     <span class="keywordflow">else</span>
00056         <span class="keywordflow">return</span> 0;
00057 }
00058 
<a name="l00059"></a><a class="code" href="classQtFileIconDrag.html#QtFileIconDraga2">00059</a> QByteArray <a class="code" href="classQtFileIconDrag.html#QtFileIconDraga2">QtFileIconDrag::encodedData</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* mime )<span class="keyword"> const</span>
00060 <span class="keyword"></span>{
00061     QByteArray a;
00062     <span class="keywordflow">if</span> ( QString( mime ) == <span class="stringliteral">"application/x-qiconlist"</span> ) {
00063         a = QIconDrag::encodedData( mime );
00064     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( QString( mime ) == <span class="stringliteral">"text/uri-list"</span> ) {
00065         QString s = <a class="code" href="classQtFileIconDrag.html#QtFileIconDragr0">urls</a>.join( <span class="stringliteral">"\r\n"</span> );
00066         a.resize( s.length() );
00067         memcpy( a.data(), s.latin1(), s.length() );
00068     }
00069     <span class="keywordflow">return</span> a;
00070 }
00071 
<a name="l00072"></a><a class="code" href="classQtFileIconDrag.html#QtFileIconDrage0">00072</a> <span class="keywordtype">bool</span> <a class="code" href="classQtFileIconDrag.html#QtFileIconDrage0">QtFileIconDrag::canDecode</a>( QMimeSource* e )
00073 {
00074     <span class="keywordflow">return</span> e-&gt;provides( <span class="stringliteral">"application/x-qiconlist"</span> ) ||
00075         e-&gt;provides( <span class="stringliteral">"text/uri-list"</span> );
00076 }
00077 
<a name="l00078"></a><a class="code" href="classQtFileIconDrag.html#QtFileIconDraga3">00078</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconDrag.html#QtFileIconDraga3">QtFileIconDrag::append</a>( <span class="keyword">const</span> QIconDragItem &amp;item, <span class="keyword">const</span> QRect &amp;pr,
00079                              <span class="keyword">const</span> QRect &amp;tr, <span class="keyword">const</span> QString &amp;url )
00080 {
00081     QIconDrag::append( item, pr, tr );
00082     QString ourUrl = url;    
00083 <span class="preprocessor">#ifdef Q_WS_WIN</span>
00084 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ourUrl.length() &gt; 2 &amp;&amp; ourUrl[1] != <span class="charliteral">':'</span>) {
00085         QDir dir(ourUrl);
00086         ourUrl = dir.absPath();
00087     }
00088 <span class="preprocessor">#endif</span>
00089 <span class="preprocessor"></span>    <a class="code" href="classQtFileIconDrag.html#QtFileIconDragr0">urls</a> &lt;&lt; QUriDrag::localFileToUri(ourUrl);
00090 }
00091 
00092 <span class="comment">/*****************************************************************************</span>
00093 <span class="comment"> *</span>
00094 <span class="comment"> * Class QtFileIconViewItem</span>
00095 <span class="comment"> *</span>
00096 <span class="comment"> *****************************************************************************/</span>
00097 
<a name="l00098"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema0">00098</a> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema0">QtFileIconViewItem::QtFileIconViewItem</a>( <a class="code" href="classQtFileIconView.html">QtFileIconView</a> *parent, QFileInfo *fi ,<span class="keywordtype">int</span> pixindex)
00099     : QIconViewItem( parent, fi-&gt;fileName() ), itemFileName( fi-&gt;filePath() ),PixIndex(pixindex),
00100       itemFileInfo( fi ), checkSetText( FALSE )
00101 {
00102     vm = QtFileIconView::Large;<span class="comment">//view mode</span>
00103 
00104    <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>-&gt;isFile() )
00105     {
00106         <span class="keywordflow">if</span>(fi-&gt;extension()==<span class="stringliteral">"jpg"</span>||fi-&gt;extension()==<span class="stringliteral">"png"</span>||fi-&gt;extension()==<span class="stringliteral">"bmp"</span>||fi-&gt;extension()==<span class="stringliteral">"jpeg"</span>)
00107         <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp2">itemType</a>=<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw3">Image</a>;
00108         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fi-&gt;extension()==<span class="stringliteral">"mp3"</span>)
00109         {
00110         <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp2">itemType</a> = <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw0">File</a>;<span class="comment">//MP3 File</span>
00111         }
00112     }
00113 
00114     <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp3">checkSetText</a> = TRUE;
00115 
00116     QObject::connect( &amp;timer, SIGNAL( timeout() ), iconView(), SLOT( openFolder() ) );
00117         <span class="keywordflow">if</span>(<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp2">itemType</a>==<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw3">Image</a>)
00118         {
00119                  <span class="keywordflow">if</span>(<a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp6">PixIndex</a>])
00120                  {
00121                         <span class="keyword">delete</span> <a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp6">PixIndex</a>];
00122                  }
00123                  <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemo0">img</a>=QPixmap(<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a>);
00124                 <a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp6">PixIndex</a>]=<a class="code" href="qfileiconview_8h.html#a2">addBorder</a>(&amp;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemo0">img</a>,1);
00125                 setPixmap(*<a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp6">PixIndex</a>]);
00126         }
00127 }
<a name="l00128"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema10">00128</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema10">QtFileIconViewItem::paintItem</a>( QPainter *p, <span class="keyword">const</span> QColorGroup &amp;cg )
00129 {
00130     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>-&gt;isSymLink() ) {
00131         QFont f( p-&gt;font() );
00132         f.setItalic( TRUE );
00133         p-&gt;setFont( f );
00134     }
00135     QIconViewItem::paintItem( p, cg );
00136 }
00137 
<a name="l00138"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema9">00138</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema9">QtFileIconViewItem::viewModeChanged</a>( QtFileIconView::ViewMode m )
00139 {
00140     vm = m;
00141     setDropEnabled( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp2">itemType</a> == <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> &amp;&amp; QDir( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> ).isReadable() );
00142     calcRect();
00143 }
00144 
<a name="l00145"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema6">00145</a> QPixmap *<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema6">QtFileIconViewItem::pixmap</a>()<span class="keyword"> const</span>
00146 <span class="keyword"></span>{
00147     <span class="keywordflow">switch</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp2">itemType</a> ) 
00148     {
00149    
00150         <span class="keywordflow">case</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw3">Image</a>:
00151         {
00152                 <span class="keywordflow">return</span> <a class="code" href="qfileiconview_8cpp.html#a1">ArrayImage</a>[<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp6">PixIndex</a>];
00153         }
00154         <span class="keywordflow">default</span>:
00155         {
00156                 <span class="keywordflow">return</span> <a class="code" href="qfileiconview_8cpp.html#a0">iconFileLarge</a>;
00157         }
00158     }
00159 }
00160 
<a name="l00161"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema1">00161</a> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema1">QtFileIconViewItem::~QtFileIconViewItem</a>()
00162 {
00163     <span class="keyword">delete</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>;
00164 }
00165 
<a name="l00166"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema5">00166</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema5">QtFileIconViewItem::setText</a>( <span class="keyword">const</span> QString &amp;text )
00167 {
00168     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp3">checkSetText</a> ) {
00169         <span class="keywordflow">if</span> ( text == <span class="stringliteral">"."</span> || text == <span class="stringliteral">"."</span> || text.isEmpty() )
00170             <span class="keywordflow">return</span>;
00171         QDir dir( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>-&gt;dir() );
00172         <span class="keywordflow">if</span> ( dir.rename( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>-&gt;fileName(), text ) ) {
00173             <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> = <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>-&gt;dirPath( TRUE ) + <span class="stringliteral">"/"</span> + text;
00174             <span class="keyword">delete</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a>;
00175             <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp1">itemFileInfo</a> = <span class="keyword">new</span> QFileInfo( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> );
00176             QIconViewItem::setText( text );
00177         }
00178     } <span class="keywordflow">else</span> {
00179         QIconViewItem::setText( text );
00180     }
00181 }
00182 
<a name="l00183"></a><a class="code" href="qfileiconview_8h.html#a2">00183</a> QPixmap* <a class="code" href="qfileiconview_8h.html#a2">addBorder</a>(QPixmap *pix, <span class="keywordtype">bool</span> hasAlpha)
00184 {
00185         <span class="comment">//DAVID Read Background</span>
00186         QPixmap pbgxpm=QPixmap(<span class="stringliteral">"/root/kde_application/hdass08/skin/bgxpm.png"</span>);
00187         <span class="comment">//DAVID Read Boarder Image</span>
00188         QImage ptop=QImage(<span class="stringliteral">"/root/kde_application/hdass08/skin/border.png"</span>);
00189         
00190         <span class="comment">//DAVID New a QPixmap res with size pix-&gt;size()</span>
00191         QPixmap res(pix-&gt;size());
00192         
00193         <span class="comment">//Draw it on painter</span>
00194         QPainter p(&amp;res);
00195                 <span class="keywordflow">if</span>(hasAlpha) 
00196                         p.drawTiledPixmap (0, 0, pix-&gt;width(), pix-&gt;height(),pbgxpm);
00197                 <span class="comment">//DAVID draw broder to painter          </span>
00198                 p.drawImage(0, 0, ptop.scale(pix-&gt;width(), pix-&gt;height()));
00199                 p.drawImage((<span class="keywordtype">int</span>)floor((<span class="keywordtype">float</span>)pix-&gt;width()/ptop.width()*14),
00200                         (<span class="keywordtype">int</span>)floor((<span class="keywordtype">float</span>)pix-&gt;height()/ptop.height()*13),
00201                         pix-&gt;convertToImage().smoothScale(
00202                                 (<span class="keywordtype">int</span>)ceil(pix-&gt;width()*0.79738562092),
00203                                 (<span class="keywordtype">int</span>)ceil(pix-&gt;height()*0.76691729323)));
00204         p.end();
00205         QImage a=res.convertToImage().scale(70,70);
00206         QPixmap *temp=<span class="keyword">new</span> QPixmap(a);
00207         <span class="keywordflow">return</span> temp;
00208 }
<a name="l00209"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema4">00209</a> <span class="keywordtype">bool</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema4">QtFileIconViewItem::acceptDrop</a>( <span class="keyword">const</span> QMimeSource *e )<span class="keyword"> const</span>
00210 <span class="keyword"></span>{
00211     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> &amp;&amp; e-&gt;provides( <span class="stringliteral">"text/uri-list"</span> ) &amp;&amp;
00212          dropEnabled() )
00213         <span class="keywordflow">return</span> TRUE;
00214 
00215     <span class="keywordflow">return</span> FALSE;
00216 }
00217 
<a name="l00218"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemb0">00218</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemb0">QtFileIconViewItem::dropped</a>( QDropEvent *e, <span class="keyword">const</span> QValueList&lt;QIconDragItem&gt; &amp; )
00219 {
00220     timer.stop();
00221 
00222     <span class="keywordflow">if</span> ( !QUriDrag::canDecode( e ) ) {
00223         e-&gt;ignore();
00224         <span class="keywordflow">return</span>;
00225     }
00226 
00227     QStringList lst;
00228     QUriDrag::decodeLocalFiles( e, lst );
00229 
00230     QString str;
00231     <span class="keywordflow">if</span> ( e-&gt;action() == QDropEvent::Copy )
00232         str = <span class="stringliteral">"Copy\n\n"</span>;
00233     <span class="keywordflow">else</span>
00234         str = <span class="stringliteral">"Move\n\n"</span>;
00235     <span class="keywordflow">for</span> ( uint i = 0; i &lt; lst.count(); ++i )
00236         str += QString( <span class="stringliteral">"   %1\n"</span> ).arg( lst[i] );
00237     str += QString( <span class="stringliteral">"\n"</span>
00238         <span class="stringliteral">"To\n\n"</span>
00239         <span class="stringliteral">"       %1"</span> ).arg( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() );
00240 
00241     QMessageBox::information( iconView(), e-&gt;action() == QDropEvent::Copy ? <span class="stringliteral">"Copy"</span> : <span class="stringliteral">"Move"</span> , str, <span class="stringliteral">"Not Implemented"</span> );
00242     <span class="keywordflow">if</span> ( e-&gt;action() == QDropEvent::Move )
00243         QMessageBox::information( iconView(), <span class="stringliteral">"Remove"</span> , str, <span class="stringliteral">"Not Implemented"</span> );
00244     e-&gt;acceptAction();
00245 }
00246 
<a name="l00247"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema7">00247</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema7">QtFileIconViewItem::dragEntered</a>()
00248 {
00249     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() != <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> ||
00250          <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> &amp;&amp; !QDir( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> ).isReadable() )
00251         <span class="keywordflow">return</span>;
00252 
00253     ( (<a class="code" href="classQtFileIconView.html">QtFileIconView</a>*)iconView() )-&gt;setOpenItem( <span class="keyword">this</span> );
00254     timer.start( 1500 );
00255 }
00256 
<a name="l00257"></a><a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema8">00257</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema8">QtFileIconViewItem::dragLeft</a>()
00258 {
00259     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() != <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> ||
00260          <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemw4QtFileIconViewItemw1">Dir</a> &amp;&amp; !QDir( <a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> ).isReadable() )
00261         <span class="keywordflow">return</span>;
00262 
00263     timer.stop();
00264 }
00265 
00266 <span class="comment">/*****************************************************************************</span>
00267 <span class="comment"> *</span>
00268 <span class="comment"> * Class QtFileIconView</span>
00269 <span class="comment"> *</span>
00270 <span class="comment"> *****************************************************************************/</span>
00271 
<a name="l00272"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewa0">00272</a> <a class="code" href="classQtFileIconView.html#QtFileIconViewa0">QtFileIconView::QtFileIconView</a>( <span class="keyword">const</span> QString &amp;dir, <a class="code" href="classQWidget.html">QWidget</a> *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,FloderType type )
00273     : QIconView( parent, name ), viewDir( dir ), newFolderNum( 0 ),flodertype(type)
00274 {
00275    
00276         qAddPostRoutine( <a class="code" href="qfileiconview_8cpp.html#a2">cleanup</a> );
00277         <span class="comment">//MP3 File Icon</span>
00278         <a class="code" href="qfileiconview_8cpp.html#a0">iconFileLarge</a> = <span class="keyword">new</span> QPixmap( <span class="stringliteral">"/root/kde_application/hdass08/skin/mp3icon.png"</span> );
00279         <a class="code" href="classQtFileIconView.html#QtFileIconViewp4">vm</a> = <a class="code" href="classQtFileIconView.html#QtFileIconVieww2QtFileIconVieww0">Large</a>;
00280 
00281     setGridX( 75 );
00282     setGridY( 75 );
00283     setResizeMode( Adjust );
00284     setWordWrapIconText( FALSE );
00285 
00286     connect( <span class="keyword">this</span>, SIGNAL( doubleClicked( QIconViewItem * ) ),
00287              <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj0">itemDoubleClicked</a>( QIconViewItem * ) ) );
00288     connect( <span class="keyword">this</span>, SIGNAL( returnPressed( QIconViewItem * ) ),
00289              <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj0">itemDoubleClicked</a>( QIconViewItem * ) ) );
00290     connect( <span class="keyword">this</span>, SIGNAL( dropped( QDropEvent *, <span class="keyword">const</span> QValueList&lt;QIconDragItem&gt; &amp; ) ),
00291              <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj2">slotDropped</a>( QDropEvent *, <span class="keyword">const</span> QValueList&lt;QIconDragItem&gt; &amp; ) ) );
00292     connect( <span class="keyword">this</span>, SIGNAL( contextMenuRequested( QIconViewItem *, <span class="keyword">const</span> QPoint &amp; ) ),
00293              <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj14">slotRightPressed</a>( QIconViewItem * ) ) );
00294     connect(<span class="keyword">this</span>,SIGNAL(clicked( QIconViewItem *)),<span class="keyword">this</span>,SLOT(<a class="code" href="classQtFileIconView.html#QtFileIconViewj1">itemClicked</a>(QIconViewItem* ))); 
00295     setHScrollBarMode( AlwaysOff );
00296     setVScrollBarMode( Auto );
00297 
00298     setAutoArrange( TRUE );
00299     setSorting( TRUE );
00300     <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a> = 0;
00301 }
00302 
<a name="l00303"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj15">00303</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj15">QtFileIconView::openFolder</a>()
00304 {
00305     <span class="keywordflow">if</span> ( !<a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a> )
00306         <span class="keywordflow">return</span>;
00307     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() != QtFileIconViewItem::Dir ||
00308          <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == QtFileIconViewItem::Dir &amp;&amp;
00309          !QDir( <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> ).isReadable() )
00310         <span class="keywordflow">return</span>;
00311 
00312     <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp4">timer</a>.stop();
00313     <a class="code" href="classQtFileIconView.html#QtFileIconViewi0">setDirectory</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp0">itemFileName</a> );
00314 }
00315 
<a name="l00316"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewi0">00316</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewi0">QtFileIconView::setDirectory</a>( <span class="keyword">const</span> QString &amp;dir )
00317 {
00318     <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> = QDir( dir );
00319     <a class="code" href="classQtFileIconView.html#QtFileIconViewb0">readDir</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> );
00320 }
00321 
<a name="l00322"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewi1">00322</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewi0">QtFileIconView::setDirectory</a>( <span class="keyword">const</span> QDir &amp;dir )
00323 {
00324     <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> = dir;
00325     <a class="code" href="classQtFileIconView.html#QtFileIconViewb0">readDir</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> );
00326 }
00327 
<a name="l00328"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewi2">00328</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewi2">QtFileIconView::newDirectory</a>()
00329 {
00330     setAutoArrange( FALSE );
00331     selectAll( FALSE );
00332     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a>.mkdir( QString( <span class="stringliteral">"New Folder %1"</span> ).arg( ++<a class="code" href="classQtFileIconView.html#QtFileIconViewp1">newFolderNum</a> ) ) ) 
00333     {                                                                        
00334         QFileInfo *fi = <span class="keyword">new</span> QFileInfo( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a>, QString( <span class="stringliteral">"New Folder %1"</span> ).arg( <a class="code" href="classQtFileIconView.html#QtFileIconViewp1">newFolderNum</a> ) );
00335         <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = <span class="keyword">new</span> <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>( <span class="keyword">this</span>, <span class="keyword">new</span> QFileInfo( *fi ) ,0);
00336         item-&gt;setKey( QString( <span class="stringliteral">"000000%1"</span> ).arg( fi-&gt;fileName() ) );
00337         <span class="keyword">delete</span> fi;
00338         repaintContents( contentsX(), contentsY(), contentsWidth(), contentsHeight(), FALSE );
00339         ensureItemVisible( item );
00340         item-&gt;setSelected( TRUE, TRUE );
00341         setCurrentItem( item );
00342         repaintItem( item );
00343         qApp-&gt;processEvents();
00344         item-&gt;rename();
00345     }
00346     setAutoArrange( TRUE );
00347 }
00348 
<a name="l00349"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewi3">00349</a> QDir <a class="code" href="classQtFileIconView.html#QtFileIconViewi3">QtFileIconView::currentDir</a>()
00350 {
00351     <span class="keywordflow">return</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a>;
00352 }
00353 
<a name="l00354"></a><a class="code" href="qfileiconview_8cpp.html#a4">00354</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="qfileiconview_8cpp.html#a4">isRoot</a>( <span class="keyword">const</span> QString &amp;s )
00355 {
00356 <span class="preprocessor">#if defined(Q_OS_UNIX)</span>
00357 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( s == <span class="stringliteral">"/"</span> )
00358         <span class="keywordflow">return</span> TRUE;
00359 <span class="preprocessor">#elif defined(Q_OS_WIN32)</span>
00360 <span class="preprocessor"></span>    QString p = s;
00361     <span class="keywordflow">if</span> ( p.length() == 3 &amp;&amp;
00362          p.right( 2 ) == <span class="stringliteral">":/"</span> )
00363         <span class="keywordflow">return</span> TRUE;
00364     <span class="keywordflow">if</span> ( p[ 0 ] == <span class="charliteral">'/'</span> &amp;&amp; p[ 1 ] == <span class="charliteral">'/'</span> ) {
00365         <span class="keywordtype">int</span> slashes = p.contains( <span class="charliteral">'/'</span> );
00366         <span class="keywordflow">if</span> ( slashes &lt;= 3 )
00367             <span class="keywordflow">return</span> TRUE;
00368         <span class="keywordflow">if</span> ( slashes == 4 &amp;&amp; p[ (<span class="keywordtype">int</span>)p.length() - 1 ] == <span class="charliteral">'/'</span> )
00369             <span class="keywordflow">return</span> TRUE;
00370     }
00371 <span class="preprocessor">#endif</span>
00372 <span class="preprocessor"></span>
00373     <span class="keywordflow">return</span> FALSE;
00374 }
00375 
<a name="l00376"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewb0">00376</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewb0">QtFileIconView::readDir</a>( <span class="keyword">const</span> QDir &amp;dir )
00377 {
00378    QDir s=dir;
00379    <span class="keywordflow">if</span>(<a class="code" href="classQtFileIconView.html#QtFileIconViewp6">flodertype</a>==Image)
00380    {
00381         s.setNameFilter(<span class="stringliteral">"*.jpg"</span>);
00382    }
00383    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classQtFileIconView.html#QtFileIconViewp6">flodertype</a>==<a class="code" href="qfileiconview_8h.html#a3a1">Music</a>)
00384    {
00385         s.setNameFilter(<span class="stringliteral">"*.mp3"</span>);
00386    }
00387    <span class="keywordflow">if</span> ( !dir.isReadable() )
00388         <span class="keywordflow">return</span>;
00389 
00390     <span class="keywordflow">if</span> ( <a class="code" href="qfileiconview_8cpp.html#a4">isRoot</a>( dir.absPath() ) )
00391         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl5">disableUp</a>();
00392     <span class="keywordflow">else</span>
00393         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl4">enableUp</a>();
00394 
00395     clear();
00396 
00397     emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl0">directoryChanged</a>( s.absPath() );
00398 
00399     <span class="keyword">const</span> QFileInfoList *filist = s.entryInfoList( QDir::Files );
00400 
00401     emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl1">startReadDir</a>( filist-&gt;count() );
00402 
00403     <span class="keywordtype">int</span> pixindex=0;
00404     QFileInfoListIterator it( *filist );
00405     QFileInfo *fi;
00406     <span class="keywordtype">bool</span> allowRename = FALSE, allowRenameSet = FALSE;
00407     <span class="keywordflow">while</span> ( ( fi = it.current() ) != 0 ) {
00408         
00409         ++it;
00410         <span class="keywordflow">if</span> ( fi &amp;&amp; fi-&gt;fileName() == <span class="stringliteral">".."</span> &amp;&amp; ( fi-&gt;dirPath() == <span class="stringliteral">"/"</span> || fi-&gt;dirPath().isEmpty() ) )
00411             <span class="keywordflow">continue</span>;
00412         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl2">readNextDir</a>();
00413         <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = <span class="keyword">new</span> <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>( <span class="keyword">this</span>, <span class="keyword">new</span> QFileInfo( *fi ),pixindex );
00414         <span class="keywordflow">if</span> ( fi-&gt;isDir() )
00415             item-&gt;setKey( QString( <span class="stringliteral">"000000%1"</span> ).arg( fi-&gt;fileName() ) );
00416         <span class="keywordflow">else</span>
00417             item-&gt;setKey( fi-&gt;fileName() );
00418         <span class="keywordflow">if</span> ( !allowRenameSet ) {
00419             <span class="keywordflow">if</span> ( !QFileInfo( fi-&gt;absFilePath() ).isWritable() ||
00420                  item-&gt;text() == <span class="stringliteral">"."</span> || item-&gt;text() == <span class="stringliteral">".."</span> )
00421                 allowRename = FALSE;
00422             <span class="keywordflow">else</span>
00423                 allowRename = TRUE;
00424             <span class="keywordflow">if</span> ( item-&gt;text() == <span class="stringliteral">"."</span> || item-&gt;text() == <span class="stringliteral">".."</span> )
00425                 allowRenameSet = FALSE;
00426             <span class="keywordflow">else</span>
00427                 allowRenameSet = TRUE;
00428         }
00429         item-&gt;setRenameEnabled( allowRename );
00430         ++pixindex;
00431     }
00432 
00433     <span class="keywordflow">if</span> ( !QFileInfo( s.absPath() ).isWritable() )
00434         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl7">disableMkdir</a>();
00435     <span class="keywordflow">else</span>
00436         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl6">enableMkdir</a>();
00437 
00438     emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl3">readDirDone</a>();
00439 }
00440 
<a name="l00441"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj0">00441</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj0">QtFileIconView::itemDoubleClicked</a>( QIconViewItem *i )
00442 {
00443     <span class="comment">//qWarning("DAVID Test for itemDoubleClicked!!");</span>
00444     <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = ( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>* )i;
00445     <span class="keywordflow">if</span> ( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == QtFileIconViewItem::Dir ) 
00446     {
00447         <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> = QDir( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() );
00448         <a class="code" href="classQtFileIconView.html#QtFileIconViewb0">readDir</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> );
00449     } 
00450     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>() == QtFileIconViewItem::Link &amp;&amp; QFileInfo( QFileInfo( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() ).readLink() ).isDir() ) 
00451     {
00452         <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> = QDir( QFileInfo( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() ).readLink() );
00453         <a class="code" href="classQtFileIconView.html#QtFileIconViewb0">readDir</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a> );
00454     }
00455     
00456     <span class="comment">//DAVID  If double clicked ,then send the file item to the playlist.</span>
00457     
00458     <span class="comment">//DAVID Check that if the file type,u just need to send mp3 file to the playlist.</span>
00459     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>()==QtFileIconViewItem::File)<span class="comment">//MP3 file</span>
00460     {
00461         <span class="comment">//DAVID send the file path to the playlist.</span>
00462         kdDebug()&lt;&lt;item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>();
00463         KURL url(QString(<span class="stringliteral">"file:"</span>)+item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>());
00464         qWarning(url.fileName());
00465         KURL::List list;
00466         list&lt;&lt;url;
00467         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl8">signalAddFileToList</a>(list,<a class="code" href="enum_8h.html#a24a20">mm_append</a>);
00468     }
00469     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema2">type</a>()==QtFileIconViewItem::Image)<span class="comment">//Image file</span>
00470     {
00471         <span class="comment">//DAVID Show the detail of Image</span>
00472         kdDebug()&lt;&lt;item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>();
00473         KURL url(QString(<span class="stringliteral">"file:"</span>)+item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>());
00474         emit <a class="code" href="classQtFileIconView.html#QtFileIconViewl9">signalShowTheDetialofImage</a>(url);
00475     }
00476     
00477 }
00478 
<a name="l00479"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewb1">00479</a> QDragObject *<a class="code" href="classQtFileIconView.html#QtFileIconViewb1">QtFileIconView::dragObject</a>()
00480 {
00481 
00482     <span class="keywordflow">if</span> ( !currentItem() )
00483         <span class="keywordflow">return</span> 0;
00484 
00485     QPoint orig = viewportToContents( viewport()-&gt;mapFromGlobal( QCursor::pos() ) );
00486     <a class="code" href="classQtFileIconDrag.html">QtFileIconDrag</a> *drag = <span class="keyword">new</span> <a class="code" href="classQtFileIconDrag.html">QtFileIconDrag</a>( viewport() );
00487     drag-&gt;setPixmap( *currentItem()-&gt;pixmap(),
00488                      QPoint( currentItem()-&gt;pixmapRect().width() / 2, currentItem()-&gt;pixmapRect().height() / 2 ) );
00489     <span class="keywordflow">for</span> ( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = (<a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>*)firstItem(); item;
00490           item = (<a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>*)item-&gt;nextItem() ) {
00491         <span class="keywordflow">if</span> ( item-&gt;isSelected() ) {
00492             QIconDragItem <span class="keywordtype">id</span>;
00493             <span class="keywordtype">id</span>.setData( QCString( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() ) );
00494             drag-&gt;<a class="code" href="classQtFileIconDrag.html#QtFileIconDraga3">append</a>( <span class="keywordtype">id</span>,
00495                           QRect( item-&gt;pixmapRect( FALSE ).x() - orig.x(),
00496                                  item-&gt;pixmapRect( FALSE ).y() - orig.y(),
00497                                  item-&gt;pixmapRect().width(), item-&gt;pixmapRect().height() ),
00498                           QRect( item-&gt;textRect( FALSE ).x() - orig.x(),
00499                                  item-&gt;textRect( FALSE ).y() - orig.y(),
00500                                  item-&gt;textRect().width(), item-&gt;textRect().height() ),
00501                           QString( item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>() ) );
00502         }
00503     }
00504     <span class="keywordflow">return</span> drag;
00505 }
00506 
<a name="l00507"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewb2">00507</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewb2">QtFileIconView::keyPressEvent</a>( QKeyEvent *e )
00508 {
00509     <span class="keywordflow">if</span> ( e-&gt;key() == Key_N &amp;&amp;
00510          ( e-&gt;state() &amp; ControlButton ) )
00511         <a class="code" href="classQtFileIconView.html#QtFileIconViewi2">newDirectory</a>();
00512     <span class="keywordflow">else</span>
00513         QIconView::keyPressEvent( e );
00514 }
00515 
<a name="l00516"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj2">00516</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj2">QtFileIconView::slotDropped</a>( QDropEvent *e, <span class="keyword">const</span> QValueList&lt;QIconDragItem&gt; &amp; )
00517 {
00518     <span class="keywordflow">if</span> ( <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a> )
00519         <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a>-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItemp4">timer</a>.stop();
00520     <span class="keywordflow">if</span> ( !QUriDrag::canDecode( e ) ) {
00521         e-&gt;ignore();
00522         <span class="keywordflow">return</span>;
00523     }
00524 
00525     QStringList lst;
00526     QUriDrag::decodeLocalFiles( e, lst );
00527 
00528     QString str;
00529     <span class="keywordflow">if</span> ( e-&gt;action() == QDropEvent::Copy )
00530         str = <span class="stringliteral">"Copy\n\n"</span>;
00531     <span class="keywordflow">else</span>
00532         str = <span class="stringliteral">"Move\n\n"</span>;
00533     <span class="keywordflow">for</span> ( uint i = 0; i &lt; lst.count(); ++i )
00534         str += QString( <span class="stringliteral">"   %1\n"</span> ).arg( QDir::convertSeparators(lst[i]) );
00535     str += QString( <span class="stringliteral">"\n"</span>
00536         <span class="stringliteral">"To\n\n"</span>
00537         <span class="stringliteral">"       %1"</span> ).arg( <a class="code" href="classQtFileIconView.html#QtFileIconViewp0">viewDir</a>.absPath() );
00538 
00539     QMessageBox::information( <span class="keyword">this</span>, e-&gt;action() == QDropEvent::Copy ? <span class="stringliteral">"Copy"</span> : <span class="stringliteral">"Move"</span> , str, <span class="stringliteral">"Not Implemented"</span> );
00540     <span class="keywordflow">if</span> ( e-&gt;action() == QDropEvent::Move )
00541         QMessageBox::information( <span class="keyword">this</span>, <span class="stringliteral">"Remove"</span> , QDir::convertSeparators(lst.join(<span class="stringliteral">"\n"</span>)), <span class="stringliteral">"Not Implemented"</span> );
00542     e-&gt;acceptAction();
00543     <a class="code" href="classQtFileIconView.html#QtFileIconViewp5">openItem</a> = 0;
00544 }
00545 
<a name="l00546"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj3">00546</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj3">QtFileIconView::viewLarge</a>()
00547 {
00548     <a class="code" href="classQtFileIconView.html#QtFileIconViewa1">setViewMode</a>( <a class="code" href="classQtFileIconView.html#QtFileIconVieww2QtFileIconVieww0">Large</a> );
00549 }
00550 
<a name="l00551"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj4">00551</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj4">QtFileIconView::viewSmall</a>()
00552 {
00553     <a class="code" href="classQtFileIconView.html#QtFileIconViewa1">setViewMode</a>( <a class="code" href="classQtFileIconView.html#QtFileIconVieww2QtFileIconVieww1">Small</a> );
00554 }
00555 
<a name="l00556"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj5">00556</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj5">QtFileIconView::viewBottom</a>()
00557 {
00558     setItemTextPos( Bottom );
00559 }
00560 
<a name="l00561"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj6">00561</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj6">QtFileIconView::viewRight</a>()
00562 {
00563     setItemTextPos( Right );
00564 }
00565 
<a name="l00566"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj7">00566</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj7">QtFileIconView::flowEast</a>()
00567 {
00568     setHScrollBarMode( AlwaysOff );
00569     setVScrollBarMode( Auto );
00570     setArrangement( LeftToRight );
00571 }
00572 
<a name="l00573"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj8">00573</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj8">QtFileIconView::flowSouth</a>()
00574 {
00575     setVScrollBarMode( AlwaysOff );
00576     setHScrollBarMode( Auto );
00577     setArrangement( TopToBottom );
00578 }
00579 
<a name="l00580"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj11">00580</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj11">QtFileIconView::sortAscending</a>()
00581 {
00582     sort( TRUE );
00583 }
00584 
<a name="l00585"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj12">00585</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj12">QtFileIconView::sortDescending</a>()
00586 {
00587     sort( FALSE );
00588 }
00589 
<a name="l00590"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj9">00590</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj9">QtFileIconView::itemTextTruncate</a>()
00591 {
00592     setWordWrapIconText( FALSE );
00593 }
00594 
<a name="l00595"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj10">00595</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj10">QtFileIconView::itemTextWordWrap</a>()
00596 {
00597     setWordWrapIconText( TRUE );
00598 }
00599 
<a name="l00600"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj14">00600</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj14">QtFileIconView::slotRightPressed</a>( QIconViewItem *item )
00601 {
00602     <span class="keywordflow">if</span> ( !item ) { <span class="comment">// right pressed on viewport</span>
00603         QPopupMenu menu( <span class="keyword">this</span> );
00604 
00605         menu.insertItem( <span class="stringliteral">"&amp;Large view"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj3">viewLarge</a>() ) );
00606         menu.insertItem( <span class="stringliteral">"&amp;Small view"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj4">viewSmall</a>() ) );
00607         menu.insertSeparator();
00608         menu.insertItem( <span class="stringliteral">"Text at the &amp;bottom"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj5">viewBottom</a>() ) );
00609         menu.insertItem( <span class="stringliteral">"Text at the &amp;right"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj6">viewRight</a>() ) );
00610         menu.insertSeparator();
00611         menu.insertItem( <span class="stringliteral">"Arrange l&amp;eft to right"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj7">flowEast</a>() ) );
00612         menu.insertItem( <span class="stringliteral">"Arrange t&amp;op to bottom"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj8">flowSouth</a>() ) );
00613         menu.insertSeparator();
00614         menu.insertItem( <span class="stringliteral">"&amp;Truncate item text"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj9">itemTextTruncate</a>() ) );
00615         menu.insertItem( <span class="stringliteral">"&amp;Wordwrap item text"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj10">itemTextWordWrap</a>() ) );
00616         menu.insertSeparator();
00617         menu.insertItem( <span class="stringliteral">"Arrange items in &amp;grid"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj13">arrangeItemsInGrid</a>() ) );
00618         menu.insertSeparator();
00619         menu.insertItem( <span class="stringliteral">"Sort &amp;ascending"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj11">sortAscending</a>() ) );
00620         menu.insertItem( <span class="stringliteral">"Sort &amp;descending"</span>, <span class="keyword">this</span>, SLOT( <a class="code" href="classQtFileIconView.html#QtFileIconViewj12">sortDescending</a>() ) );
00621 
00622         menu.setMouseTracking( TRUE );
00623         menu.exec( QCursor::pos() );
00624     } <span class="keywordflow">else</span> { <span class="comment">// on item</span>
00625         QPopupMenu menu( <span class="keyword">this</span> );
00626 
00627         <span class="keywordtype">int</span> RENAME_ITEM = menu.insertItem( <span class="stringliteral">"Rename Item"</span> );
00628         <span class="keywordtype">int</span> REMOVE_ITEM = menu.insertItem( <span class="stringliteral">"Remove Item"</span> );
00629 
00630         menu.setMouseTracking( TRUE );
00631         <span class="keywordtype">int</span> <span class="keywordtype">id</span> = menu.exec( QCursor::pos() );
00632 
00633         <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> == -1 )
00634             <span class="keywordflow">return</span>;
00635 
00636         <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> == RENAME_ITEM &amp;&amp; item-&gt;renameEnabled() ) {
00637             item-&gt;rename();
00638         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> == REMOVE_ITEM ) {
00639             <span class="keyword">delete</span> item;
00640             QMessageBox::information( <span class="keyword">this</span>, <span class="stringliteral">"Not implemented!"</span>, <span class="stringliteral">"Deleting files not implemented yet,\n"</span>
00641                                       <span class="stringliteral">"The item has only been removed from the view! "</span> );
00642         }
00643     }
00644 }
00645 
<a name="l00646"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewa1">00646</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewa1">QtFileIconView::setViewMode</a>( ViewMode m )
00647 {
00648     <span class="keywordflow">if</span> ( m == <a class="code" href="classQtFileIconView.html#QtFileIconViewp4">vm</a> )
00649         <span class="keywordflow">return</span>;
00650 
00651     <a class="code" href="classQtFileIconView.html#QtFileIconViewp4">vm</a> = m;
00652     <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = (<a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>*)firstItem();
00653     <span class="keywordflow">for</span> ( ; item; item = (<a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>*)item-&gt;nextItem() )
00654         item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema9">viewModeChanged</a>( <a class="code" href="classQtFileIconView.html#QtFileIconViewp4">vm</a> );
00655 
00656     <a class="code" href="classQtFileIconView.html#QtFileIconViewj13">arrangeItemsInGrid</a>();
00657 }
<a name="l00658"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewi4">00658</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewi4">QtFileIconView::slotDeletCurrItem</a>()
00659 {
00660 
00661  <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item=( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>* )firstItem();
00662  <span class="keywordflow">while</span>(item)
00663  {
00664         <span class="keywordflow">if</span>(item-&gt;isSelected())
00665         {
00666                 QFile deletefile(item-&gt;<a class="code" href="classQtFileIconViewItem.html#QtFileIconViewItema3">filename</a>());
00667                 deletefile.remove();
00668                 <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *curitem=item;
00669                 item=( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>* )item-&gt;nextItem();
00670                 <span class="keyword">delete</span> curitem;
00671         }
00672         <span class="keywordflow">else</span>
00673         {
00674                 item=( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>* )item-&gt;nextItem();
00675         }
00676  }
00677  sort();
00678 }
<a name="l00679"></a><a class="code" href="classQtFileIconView.html#QtFileIconViewj1">00679</a> <span class="keywordtype">void</span> <a class="code" href="classQtFileIconView.html#QtFileIconViewj1">QtFileIconView::itemClicked</a>(QIconViewItem *i)
00680 {
00681   <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a> *item = ( <a class="code" href="classQtFileIconViewItem.html">QtFileIconViewItem</a>* )i;
00682   setCurrentItem(i);
00683   <span class="comment">//qWarning(item-&gt;filename());</span>
00684 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 13 16:53:36 2005 for HDASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
